---
title: "HW2: NIR Data"
author: William Mullins
date: Jan 29, 2026
format: pdf
execute:
  warning: false
  message: false
---

### Load Required Packages
***
```{r}
library(tidyverse)
library(here)
library(treemapify)
library(scales)
```

### Read in NRI Data
***
```{r}
# Read in Raw Data
nri_raw <- read.csv(here::here("data", "National_Risk_Index_Counties_807384124455672111.csv")) %>%
    janitor::clean_names() 
```

### Dictionary for Clasifying Regions
***
```{r}
# Census Bureau regions (4 regions)
us_census_regions <- list(
  
  Northeast = c("Connecticut", "Maine", "Massachusetts", "New Hampshire",
                "Rhode Island", "Vermont", "New Jersey", "New York",
                "Pennsylvania"),
  
  Midwest = c("Illinois", "Indiana", "Iowa", "Kansas", "Michigan",
              "Minnesota", "Missouri", "Nebraska", "North Dakota",
              "Ohio", "South Dakota", "Wisconsin"),
  
  South = c("Alabama", "Arkansas", "Delaware", "Florida", "Georgia",
            "Kentucky", "Louisiana", "Maryland", "Mississippi",
            "North Carolina", "Oklahoma", "South Carolina", "Tennessee",
            "Texas", "Virginia", "West Virginia", "Washington DC"),
  
  West = c("Alaska", "Arizona", "California", "Colorado", "Hawaii",
           "Idaho", "Montana", "Nevada", "New Mexico", "Oregon",
           "Utah", "Washington", "Wyoming")
)
```

### Data Cleaning
***
```{r}
# Create state level dataframe with added region column
nri_regions <- nri_raw %>% group_by(state_name, state_name_abbreviation) %>%
    summarize(national_risk_index_score_composite = mean(national_risk_index_score_composite, na.rm = TRUE),
    social_vulnerability_score = mean(social_vulnerability_score, na.rm = TRUE)) %>%
    mutate(region = case_when(
    state_name %in% us_census_regions$Northeast ~ "Northeast",
    state_name %in% us_census_regions$Midwest ~ "Midwest",
    state_name %in% us_census_regions$South ~ "South",
    state_name %in% us_census_regions$West ~ "West"
)) %>%
    filter(region != is.na(region)) # Remove territories from dataframe
```

### Treemap Visualization
```{r}
#| fig-alt: "Treemap displaying 2025 NRI data across US states where tile size represents the NRI score for each state and color indicates the social vulnerability score from purple (low, ~0) to yellow (high, ~80). States are grouped by region (Northeast, Midwest, South, West)."
ggplot(nri_regions, 
       aes(area = national_risk_index_score_composite, 
           fill = social_vulnerability_score, 
           label = state_name_abbreviation,
           subgroup = region)) +
  geom_treemap(layout = "squarified") +
  geom_treemap_subgroup_border(color = "white", 
                                layout = "squarified",
                                size = 5) +
  geom_treemap_text(fontface = "bold", 
                    color = muted("white", l = 110, c = 10), 
                    place = "centre", 
                    min.size = 2, 
                    grow = TRUE) + 
  scale_fill_viridis_c("Social\nVulnerability\nScore", 
                       limits = c(0, 80)) +
  theme_minimal() +
  theme(legend.position = "right",
        plot.title = element_text(hjust = 0.5,
                                  face = "bold",
                                  size = 16),
        plot.title.position = "plot",
        legend.title = element_text(face = "bold",
                                     size = 12),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.9, "cm")) + 
  labs(title = "National Risk Index and Social Vulnerability\nAcross US States",
       caption = "Data: FEMA National Risk Index (2025 Release)")
```

### Questions

**1. What are your variables of interest and what kinds of data (e.g. numeric, categorical, ordered, etc.) are they (a bullet point list is fine)**

- National Risk Index Composite Score: A numeric variable representing the cumulative risk of a community to the 18 hazards included in the index.
- Social Vulnerability Index Composite Score: A numeric variable measuring a communities resiliance to outside stressors.
- Region: A categorical variable grouping states into geographic regions (Northeast, Midwest, South, West).

**2. How did you decide which type of graphic form was best suited for answering the question? What alternative graphic forms could you have used instead? Why did you settle on this particular graphic form?**

I settled on using a treemap as it felt like the best way to visualize data from all 50 states individually without making a map. The treemap allows viewers to quickly assess both numeric variables quickly by just looking at tile size and colors. I debated using a horizontal bar graph or bubble chart instead, but decided on a treemap as, in addition to the advantages mentioned earlier, it allowed me to group the individual states by region.

**3. Summarize your main finding in no more than two sentences.**

States in the South show higher social vulnerability scores compared to other regions, even when compared states with similar National Risk Index scores. Furthermore, states like Louisiana, Mississippi, Alabama, and Arkansas have both high risk scores (large tiles) and high social vulnerability (yellow coloring).

**4. What modifications did you make to this visualization to make it more easily readable?**

- I used bold white text for state abbreviations to make sure the text was readable
- I grouped the data by region and added a 5pt white dividing line to help distinguish the regions 
- I used the viridis color scale as it is colorblind-friendly
- I increased the size of the legend and it's text to make it more easily readable

**5. Is there anything you wanted to implement, but didnâ€™t know how? If so, please describe.**

I wanted to add region labels positioned outside each regional grouping on the plot. The `geom_treemap_subgroup_text()` function in the treemapify package only lets you place labels labels inside the grouped boxes, which ends up interfering with the the labels on the boxes. 